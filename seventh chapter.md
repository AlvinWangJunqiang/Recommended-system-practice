# 推荐系统实例
## 外围架构
![外围架构](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic51.png?raw=true)
1. 数据收集和存储</br>
![电子商务网站中的典型行为](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic52.png?raw=true)
一般来说，需要实时存取的数据存储在数据库和缓存中，而大规模的非实时地存取数据存储在分布式文件系统（如HDFS）中。
## 推荐系统架构
用户关联物品的三种方式：</br>
![用户关联物品的三种方式](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic53.png?raw=true)
推荐系统需要由多个推荐引擎组成，每个推荐引擎负责一类特征和一种任务，而推荐系统的任务只是将推荐引擎的结果按照一定权重或者优先级合并、排序然后返回。</br>
![推荐系统架构](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic54.png?raw=true)</br>
优点：
* 可以方便地增加/删除引擎，控制不同引擎对推荐结果的影响。对于绝大多数需求，只需要通过不同的引擎组合实现。
* 可以实现推荐引擎级别的用户反馈。每一个推荐引擎其实代表了一种推荐策略，而不同的用户可能喜欢不同的推荐策略。
## 推荐引擎的架构
推荐引擎架构主要包括三部分（如下图）：
* A负责从数据库或者缓存中拿到用户行为数据，通过分析不同行为，生成当前用户的特征向量。不过如果是使用非行为特征，就不需要使用行为提取和分析模块了。该模块的输出是用户特征向量。
* B负责将用户的特征向量通过特征-物品相关矩阵转化为初始推荐物品列表。
* C负责对初始的推荐列表进行过滤、排名等处理，从而生成最终的推荐结果。</br>
![推荐引擎架构图](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic55.png?raw=true)
### 生成用户特征向量
用户的特征：
* 用户的注册信息中可以提取出来的，主要包括用户的人口统计学特征。对于使用这种特征的推荐引擎，如果内存够，可以将存储这些特征的信息直接缓存在内存中，在推荐时直接拿到用户的特征数据并生成特征向量。
* 从用户的行为中计算出来的。一个特征向量由特征以及特征的权重组成，在利用用户行为计算特征向量时需要考虑以下因素。
	
    * 用户行为种类。比如浏览和购买的权重不同。
	* 用户行为产生的时间。时间越近权重越大。
    * 用户行为的次数。产生某行为次数越多权重越大。
    * 物品热门程度。加重不热门物品对应的权重。
### 特征-物品相关推荐
特征—物品相关推荐模块还可以接受一个候选物品集合。候选物品集合的目的是保证推荐结果只包含候选物品集合中的物品。它的应用场合一般是产品需求希望将某些类型的电视剧推荐给用户。比如有些产品要求给用户推荐最近一周加入的新物品，那么候选物品集合就包括最近一周新加的物品。
### 过滤模块
过滤模块一般会过滤掉以下物品：
* 用户已经产生过行为物品
* 候选物品以外的物品
* 某些质量很差的物品
### 排名模块
1. 新颖性排名</br>![新颖性排名](https://github.com/easezyc/Recommended-system-practice/blob/master/pics/pic56.png?raw=true)
2. 多样性
	* 第一种提高多样性的方法是将推荐结果按照某种物品的内容属性分成几类，然后在每个类中都选择该类中排名最高的物品组合成最终的推荐列表。这种方法的好处是比较简单直观，但这种方法也有严重的缺点。首先，选择什么样的内容属性进行分类对结果的影响很大。其次，就算选择了某种类别，但物品是否属于某个类别是编辑确定的，并不一定能够得到用户的公认。
	* 第二种提高推荐结果多样性的方法是控制不同推荐结果的推荐理由出现的次数。本章提出的推荐系统对于每个推荐出来的物品都有一个推荐理由，这个推荐理由一般是产生推荐结果的重要特征。那么，要提高推荐结果的多样性，就需要让推荐结果尽量来自不同的特征，具有不同的推荐理由，而不是所有的推荐结果都对应一个理由。
3. 时间多样性</br>
提高多样性的两个方面

* 要保证推荐系统的实时性，在用户有新行为时实时调整推荐结果以满足用户最近的需求。
* 要在用户没有新的行为时，也要保证推荐结果每天都有变化。通过如下方式：
	* 记录用户每次登陆推荐系统看到的推荐结果。
	* 将这些结果发回日志系统。这种数据不需要实时存储，只要能保证小于一天的延时就足够了。
	* 在用户登录时拿到用户昨天及之前看过的推荐结果列表，从当前推荐结果中将用户已经看到的推荐结果降权。
4. 用户反馈</br>
排名模块最重要的部分就是用户反馈模块。用户反馈模块主要通过分析用户之前和推荐结果的交互日志，预测用户会对什么样的推荐结果比较感兴趣。